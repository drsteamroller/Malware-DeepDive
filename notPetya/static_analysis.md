# notPetya: Static Analysis

## TrIDNET & Detect it Easy

Let's first figure out what we've got. When I unzipped the "theZoo" archive, it presented me with 2 binary files. Sparing the long hex names, the files are 788 KB and 226 KB. Let's take a look at TrIDNET and Detect it Easy to see what their actual file definitions are:

> **Larger File**<p>
<img title="Larger File [TrIDNET]" src="images/tridnetLF.png">
<img title="Larger File [Detect it Easy]" src="images/diteLF.png">
</p>

> **Smaller File**<p>
<img title="Smaller File [TrIDNET]" src="images/tridnetSF.png">
<img title="Smaller File [Detect it Easy]" src="images/diteSF.png">
</p>

So it seems as if the larger file is the main executable, and the smaller one is something peculiar. Basing my thoughts off first looks, I would guess that this file is injected somewhere (the Control Panel perhaps) and could be a way to obtain root/admin priveleges. That or it could be 2 different versions of Petya. We'll know for sure when we get to dynamic analysis.

A very top-level research of CPL files [1] tells us that they are used as an interface for system drivers. It isn't super uncommon that 3rd party hardware/software include these CPLs as part of their driver- for example, the on-board network adapter for a computer would need to include one for troubleshooting. This hints towards a possible method for persistence. 

## Strings

As you do in digital forensics, I copied the two files to a separate workspace and renamed the larger file to "PetyaPayload" and the smaller one "PetyaPersist". The latter might change as we get a better idea as to what it's purpose is.

Scrolling on through the strings of PetyaPayload, I found XML-like structure similar to what CPL files are supposed to look like [2]. It could be that the program is broken up between 2 executables, or like I said before, it could be 2 versions of Petya. 

The content however is interesting. I see that it calls itself "Microsoft.Windows.Common-Controls", and there's a <description> with the text "WinRAR SFX module". This could be part of the masquerading/social engineering that ransomwares like Petya and Wana Decrypt0r rely on in order to infect machines. Nothing else stuck out to me in the strings of the "payload", let's move onto the "persist" file.

I only really found the same CPL structure with the same exact information in PetyaPersist, which leads me to believe these are both Petya, but we still have more to look through.

## References

[1] https://support.microsoft.com/en-us/topic/description-of-control-panel-cpl-files-4dc809cd-5063-6c6d-3bee-d3f18b2e0176

[2] https://docs.fileformat.com/system/cpl/#:~:text=A%20CPL%20file%20is%20short,Displays%2C%20Networking%2C%20amongst%20others.